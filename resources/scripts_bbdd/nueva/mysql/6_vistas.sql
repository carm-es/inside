DROP VIEW V_AUDITORIA_ACCESO_NUBE_IDS;
CREATE VIEW V_AUDITORIA_ACCESO_NUBE_IDS (ID, NIF_PETICIONARIO, NIF_REMITENTE, NIF_USUARIO_ACCESO, ID_EXPEDIENTE, FECHA_ACCESO) AS select concat(`atok`.`id`,'a') AS `ID`,'DESCONOCIDO' AS `NIF_PETICIONARIO`,`uins`.`nif` AS `NIF_REMITENTE`,`atok`.`nifUsuarioUso` AS `NIF_USUARIO_ACCESO`,`etok`.`identificador` AS `ID_EXPEDIENTE`,`atok`.`fechaUso` AS `FECHA_ACCESO` from ((`AuditoriaToken` `atok` join `ExpedienteToken` `etok`) join `UsuarioInside` `uins`) where ((`atok`.`id_token` = `etok`.`id`) and (`etok`.`id_usuario` = `uins`.`id`)) union select concat(`auaccdoc`.`id`,'b') AS `ID`,if(isnull(`solaccex`.`Usuario_Peticionario`),'DESCONOCIDO',`solaccex`.`Usuario_Peticionario`) AS `NIF_PETICIONARIO`,if(isnull(`solaccex`.`NifUsuarioGeneraToken`),'DESCONOCIDO',`solaccex`.`NifUsuarioGeneraToken`) AS `NIF_REMITENTE`,if(isnull(nullif(`auaccdoc`.`Usuario_Peticionario`,'')),'DESCONOCIDO',`auaccdoc`.`Usuario_Peticionario`) AS `NIF_USUARIO_ACCESO`,`auaccdoc`.`Id_Documento` AS `ID_EXPEDIENTE`,`auaccdoc`.`Fecha` AS `FECHA_ACCESO` from (`AuditoriaAccesoDocumento` `auaccdoc` join `SolicitudAccesoExpediente` `solaccex`) where (`auaccdoc`.`Id_Peticion` = `solaccex`.`Id_Peticion`);
